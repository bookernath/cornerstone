<!DOCTYPE html>
<html class="no-js" lang="{{ locale_name }}">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>{{#if page_title}}{{page_title}}{{else}}{{settings.store_name}}{{/if}}</title>
    <meta name="description" content="{{#if meta_description}}{{meta_description}}{{else}}{{settings.meta_description}}{{/if}}">
    
    {{!-- Inject global settings --}}
    {{inject "settings" settings}}
    {{inject "customer" customer}}
    {{inject "urls" urls}}
    
    {{!-- Basic CSS for redirect notice --}}
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: {{#if theme_settings.body-font}}{{getFontFamilyName theme_settings.body-font}}{{else}}-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif{{/if}};
            line-height: 1.6;
            color: {{#if theme_settings.color-foreground}}{{theme_settings.color-foreground}}{{else}}#333{{/if}};
            background: {{#if theme_settings.color-background}}{{theme_settings.color-background}}{{else}}#fff{{/if}};
        }
        
        .redirect-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .redirect-notice {
            text-align: center;
            max-width: 600px;
            padding: 3rem;
            border: 1px solid {{#if theme_settings.color-accent}}{{theme_settings.color-accent}}{{else}}#e5e5e5{{/if}};
            border-radius: 8px;
            background-color: {{#if theme_settings.color-background}}{{theme_settings.color-background}}{{else}}#ffffff{{/if}};
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .store-logo {
            margin-bottom: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .store-logo img {
            max-height: 80px;
            width: auto;
        }
        
        .store-logo-text {
            font-size: 2rem;
            font-weight: 600;
            color: {{#if theme_settings.color-primary}}{{theme_settings.color-primary}}{{else}}#333{{/if}};
            font-family: {{#if theme_settings.headings-font}}{{getFontFamilyName theme_settings.headings-font}}{{else}}-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif{{/if}};
        }
        
        .redirect-notice h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: {{#if theme_settings.color-primary}}{{theme_settings.color-primary}}{{else}}#555{{/if}};
            font-family: {{#if theme_settings.headings-font}}{{getFontFamilyName theme_settings.headings-font}}{{else}}-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif{{/if}};
        }
        
        .redirect-notice p {
            margin-bottom: 1rem;
            color: {{#if theme_settings.color-foreground}}{{theme_settings.color-foreground}}{{else}}#666{{/if}};
            line-height: 1.6;
        }
        
        .redirect-button {
            display: inline-block;
            padding: 12px 24px;
            background-color: {{#if theme_settings.color-primary}}{{theme_settings.color-primary}}{{else}}#007bff{{/if}};
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid {{#if theme_settings.color-primary}}{{theme_settings.color-primary}}{{else}}#007bff{{/if}};
        }
        
        .redirect-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .spinner {
            border: 3px solid {{#if theme_settings.color-accent}}{{theme_settings.color-accent}}{{else}}#f3f3f3{{/if}};
            border-top: 3px solid {{#if theme_settings.color-primary}}{{theme_settings.color-primary}}{{else}}#007bff{{/if}};
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="redirect-container">
        <div class="redirect-notice">
            <div class="store-logo">
                {{#if settings.store_logo.image}}
                    <img src="{{getImage settings.store_logo.image 'logo_size'}}"
                         alt="{{settings.store_logo.title}}"
                         title="{{settings.store_logo.title}}">
                {{else}}
                    <span class="store-logo-text">{{settings.store_name}}</span>
                {{/if}}
            </div>
            <h1>Taking you to {{settings.store_name}}...</h1>
            <div class="spinner"></div>
            <p>You will be automatically redirected to our store.</p>
            <p>If you are not redirected automatically, click the button below:</p>
            <a href="#" class="redirect-button" onclick="performRedirect(); return false;">
                Continue to {{settings.store_name}}
            </a>
        </div>
    </div>

    {{!-- Include the universal redirect component --}}
    {{> components/common/catalyst-redirect}}

    {{!-- JavaScript context and redirect logic --}}
    <script>
        window.catalystSettings = {{{jsContext}}};
        
        // Catalyst redirect configuration
        window.catalystConfig = {
            baseUrl: "{{#if theme_settings.catalyst_storefront_url}}{{theme_settings.catalyst_storefront_url}}{{else}}{{settings.base_url}}{{/if}}",
            delay: {{#if theme_settings.redirect_delay}}{{theme_settings.redirect_delay}}{{else}}1000{{/if}},
            debugMode: {{#if theme_settings.enable_debug_mode}}true{{else}}false{{/if}}
        };
        
        function performRedirect() {
            try {
                // Get the current URL to preserve query params and hash
                const currentUrl = new URL(window.location.href);
                
                // Create the target URL
                const targetUrl = new URL(currentUrl.pathname + currentUrl.search + currentUrl.hash, window.catalystConfig.baseUrl);
                
                // Perform the redirect
                window.location.replace(targetUrl.toString());
            } catch (error) {
                console.error('Redirect error:', error);
                // Fallback to simple redirect
                window.location.href = window.catalystConfig.baseUrl + window.location.pathname;
            }
        }
        
        // Auto-redirect after delay
        setTimeout(performRedirect, window.catalystConfig.delay);
    </script>
</body>
</html>